<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách Đơn hàng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
    <%- include('../header', { pageTitle: ' ' }) %>

    <div class="container mt-5">
        <h1>Danh sách Đơn hàng</h1>

        <% const ordersList = orders || []; %> <!-- Check if 'orders' is null or undefined -->

        <% if (ordersList.length === 0) { %>
            <div class="alert alert-warning" role="alert">Không có đơn hàng nào được tìm thấy.</div>
        <% } else { %>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID Đơn hàng</th>
                        <th>Email Người dùng</th>
                        <th>Sản phẩm</th>
                        <th>Số lượng người lớn</th>
                        <th>Số lượng trẻ em</th>
                        <th>Tổng giá trị</th>
                        <th>Trạng thái</th>
                        <th>Ngày đặt</th>
                    </tr>
                </thead>
                <tbody>
                    <% ordersList.forEach(order => { %>
                        <tr>
                            <td><%= order.id || "Không có ID" %></td>
                            <td><%= order.user.email %> || "Không có email" %></td>
                            <td>
                                <% if (order.tour && order.tour.title) { %>
                                    <span class="badge bg-primary"><%= order.tour.title %></span>
                                <% } else { %>
                                    <span class="text-muted">Không có sản phẩm</span>
                                <% } %>
                            </td>
                            <td><%= order.adultCount || 0 %></td> <!-- Số lượng người lớn -->
                            <td><%= order.childCount || 0 %></td> <!-- Số lượng trẻ em -->
                            <td><%= order.totalValue ? order.totalValue.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) : "0 VND" %></td>
                            <td>
                                <span class="badge <%= order.status === 'pending' ? 'bg-warning' : order.status === 'processing' ? 'bg-primary' : order.status === 'paid' ? 'bg-success' : order.status === 'canceled' ? 'bg-danger' : '' %>">
                                    <%= order.status ? order.status.charAt(0).toUpperCase() + order.status.slice(1) : "Không có trạng thái" %>
                                </span>
                            </td>
                            <td><%= order.bookingDate ? new Date(order.bookingDate).toLocaleDateString('vi-VN') : "Không có ngày đặt" %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } %>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
